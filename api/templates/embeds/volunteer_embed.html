{% extends 'embed.html' %}

{% block embed_content %}
<p hidden class="success_message">Thanks for subscribing to our newsletter!</p>
<form id="taeb_server_volunteer_form_embed" class="raleway">
    <h1>Name <i>(required)</i></h1>
    <div class="form_flex">
        <label>
            First Name
            <input type="text" name="first_name" class="form-control" required/>
        </label>
        <label>
            Last Name 
            <input type="text" name="last_name" class="form-control" required/>
        </label>
    </div>
    
    <h1>Address</h1>
    <label>
        Address Line 1 <i>(required)</i>
        <input type="text" name="address1" class="form-control" required/>
    </label>
    <label>
        Address Line 2 
        <input type="text" name="address2" class="form-control"/>
    </label>
    
    <div class="form_flex">
        <label>
            City <i>(required)</i>
            <input type="text" name="city" class="form-control" required/>
        </label>
        <label>
            State <i>(required)</i>
            <select class="form-control" name="state" required>
                {% for abbreviation, state in states.items() %}
                    <option value={{abbreviation}}>{{state}}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            ZIP Code <i>(required)</i>
            <input type="text" name="zip" class="form-control" required/>
        </label>
    </div>

    <h1>Contact Information</h1>
    <label>
        Email <i>(required)</i>
        <input type="email" name="email" class="form-control" required/>
    </label>

    <label>
        Phone Number <i>(required)</i>
        <input type="tel" name="phone" class="form-control"  pattern="(?:[0-9]{3}-[0-9]{3}-[0-9]{4}|[0-9]{10}|\([0-9]{3}\) ?[0-9]{3}-[0-9]{4})" required/>
    </label>

    <h1>About You</h1>
    <label>
        Tell us a bit about yourself
        <textarea name="personal" class="form-control" required></textarea>
    </label>

    <label>
        Describe your availability
        <textarea name="availability" class="form-control" required></textarea>
    </label>

    <label>Which tasks would you like to participate in? <i>(click at least one)</i></label>
    <section id="task-selector">
        <label style="font-size: larger;">
            <input
                type="checkbox" name="tasks[]" value="canvassing" class="task-selector"
                required
                data-parsley-mincheck="1"
                data-parsley-class-handler="#task-selector"
                data-parsley-errors-container="#task-selector-error-container"
            />
            Canvassing
        </label>
        <label style="font-size: larger;">
            <input type="checkbox" name="tasks[]" value="phone-banking" class="task-selector"/>
            Phone Banking
        </label>
        <label style="font-size: larger;">
            <input type="checkbox" name="tasks[]" value="event-coordination" class="task-selector"/>
            Event Coordination
        </label>
        <label style="font-size: larger;">
            <input type="checkbox" name="tasks[]" value="lawn-sign-delivery"class="task-selector"/>
            Lawn Sign Delivery
        </label>
        <label style="font-size: larger;">
            <input type="checkbox" name="tasks[]" value="meet-and-greet-host" class="task-selector"/>
            Meet and Greet Host
        </label>
        <div id="task-selector-error-container"></div>
    </section>

    <button type="submit">Submit</button>
</form>
<script type="text/javascript">
    let form = $('#taeb_server_volunteer_form_embed');

    function parseData(formData) {
        const obj = {};

        for (const [key, value] of formData.entries()) {
            const arrayMatch = key.match(/^(.+)\[\]$/);
            if (arrayMatch) {
                const name = arrayMatch[1];
                if (!obj[name]) obj[name] = [];
                obj[name].push(value);
            } else {
                obj[key] = value;
            }
        }

        return obj;
    }

    $(function () {
        form.parsley().on('form:submit', function() {
            let data = new FormData(document.getElementById("taeb_server_volunteer_form_embed"));
            data = parseData(data);
            data.phone = data.phone.replaceAll(/\D/.global, ""); // convert all to numeric string
            console.log(data);
            return false;
        });
    });
</script>
{% endblock %}