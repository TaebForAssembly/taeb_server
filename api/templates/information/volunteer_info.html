{% extends 'page.html' %}

{% block header %}
  {{ super() }}
  <h1>{% block title %}View Volunteer{% endblock %}</h1>
{% endblock %}

{% block page_content %}
{% if volunteer %}
  <div class="content wide">
    <div class="inside">
      <p><b>Name: </b>{{volunteer.first_name}} {{volunteer.last_name}}</p>
      <p><b>Address: </b>
        {{volunteer.address1}}
        {% if volunteer.address2 %}, {{volunteer.address2}}{% endif %}
        , {{volunteer.city}}
        , {{volunteer.state}}
        , {{volunteer.zip}}
      </p>
      <p><b>Email: </b>{{volunteer.email}}</p>
      <p><b>Phone Number: </b>{{volunteer.phone}}</p>
      <b>Tasks: </b>
      <ul>
        {% for task in volunteer.tasks %}
        <li>{{task}}</li>
        {% endfor %}
      </ul>

      {% if volunteer.personal %}
      <b>Personal Information:</b>
      <p>{{volunteer.personal}}</p>
      {% endif %}
      
      <b>Availability:</b>
      <p>{{volunteer.availability}}</p>

      <p><b>Date Form Filled:</b> {{volunteer.created_at}}</p>
    </div>
  </div>

  <div class="content">
    <form id="delete_volunteer_form" data-id="{{volunteer.id}}">
      <input type="submit" value="Delete User" style="width:100%;"/>
    </form>
    <p id="delete_volunteer_form_error"></p>
  </div>

  <script>
    const form = document.getElementById("delete_volunteer_form");

    form.onsubmit = function () {
      if (!confirm("Are you sure you want to delete this user?")) return false;

      document.getElementById("delete_volunteer_form_error").innerHTML = "";

      fetch(`/volunteer/${form.getAttribute("data-id")}`, {
        method: "DELETE"
      })
      .then(response => response.json())
      .then(({success, message}) => {
        if (success) {
          alert(message);
          window.location.replace("/view/volunteers");
        }
        else document.getElementById("delete_volunteer_form_error").innerHTML = `Error: ${message}`;
      })
      .catch(() => document.getElementById("delete_volunteer_form_error").innerHTML = "Error: Server Error");
      
      return false;
    }
  </script>
{% endif %}
{% endblock %}